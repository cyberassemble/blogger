var postTitle=[],postUrl=[],postDate=[],postSum=[],postLabels=[],sortBy="datenewest",tocLoaded=!1,numChars=250,postFilter="",tocdiv=document.getElementById("bp_toc"),totalEntires=0,totalPosts=0;function loadtoc(t){!function s(){if("entry"in t.feed){var e=t.feed.entry.length;if(totalEntires+=e,(totalPosts=t.feed.openSearch$totalResults.$t)>totalEntires){var o=document.createElement("script");o.type="text/javascript",startindex=totalEntires+1,o.setAttribute("src","/feeds/posts/summary?start-index="+startindex+"&max-results=500&alt=json-in-script&callback=loadtoc"),tocdiv.appendChild(o)}for(var l=0;l<e;l++){for(var a,r=t.feed.entry[l],i=r.title.$t,n=r.published.$t.substring(0,10),c=0;c<r.link.length;c++)if("alternate"==r.link[c].rel){a=r.link[c].href;break}if("content"in r)var p=r.content.$t;else if("summary"in r)var p=r.summary.$t;else var p="";var d=/<\S[^>]*>/g;if((p=p.replace(d,"")).length>numChars){var f=(p=p.substring(0,numChars)).lastIndexOf(" ");p=p.substring(0,f)+"..."}var g="";if("category"in r){for(var c=0;c<r.category.length;c++)g+="<a href=\"javascript:filterPosts('"+r.category[c].term+"');\" title=\"Click here to select all posts with label '"+r.category[c].term+"'\">"+r.category[c].term+"</a>,  ";var h=g.lastIndexOf(",");-1!=h&&(g=g.substring(0,h))}postTitle.push(i),postDate.push(n),postUrl.push(a),postSum.push(p),postLabels.push(g)}}totalEntires==totalPosts&&(tocLoaded=!0,showToc())}(),sortPosts(sortBy),tocLoaded=!0}function filterPosts(t){displayToc(postFilter=t)}function allPosts(){displayToc(postFilter="")}function sortPosts(t){function s(t,s){var e=postTitle[t];postTitle[t]=postTitle[s],postTitle[s]=e;var e=postDate[t];postDate[t]=postDate[s],postDate[s]=e;var e=postUrl[t];postUrl[t]=postUrl[s],postUrl[s]=e;var e=postSum[t];postSum[t]=postSum[s],postSum[s]=e;var e=postLabels[t];postLabels[t]=postLabels[s],postLabels[s]=e}for(var e=0;e<postTitle.length-1;e++)for(var o=e+1;o<postTitle.length;o++)"titleasc"==t&&postTitle[e]>postTitle[o]&&s(e,o),"titledesc"==t&&postTitle[e]<postTitle[o]&&s(e,o),"dateoldest"==t&&postDate[e]>postDate[o]&&s(e,o),"datenewest"==t&&postDate[e]<postDate[o]&&s(e,o)}function displayToc(t){var s=0,e="",o="Click to sort by title",l="Click to sort by date",a="";"titleasc"==sortBy&&(o+=" (descending)",l+=" (newest first)"),"titledesc"==sortBy&&(o+=" (ascending)",l+=" (newest first)"),"dateoldest"==sortBy&&(o+=" (ascending)",l+=" (newest first)"),"datenewest"==sortBy&&(o+=" (ascending)",l+=" (oldest first)"),""!=postFilter&&(a="Click to show all posts"),e+="<table>",e+="<tr>",e+='<td class="toc-header-col1">',e+='<a href="javascript:toggleTitleSort();" title="'+o+'">POST TITLE</a>',e+="</td>",e+='<td class="toc-header-col2">',e+='<a href="javascript:toggleDateSort();" title="'+l+'">POST DATE</a>',e+="</td>",e+='<td class="toc-header-col3">',e+='<a href="javascript:allPosts();" title="'+a+'">LABELS</a>',e+="</td>",e+="</tr>";for(var r=0;r<postTitle.length;r++)""==t?(e+='<tr><td class="toc-entry-col1"><a href="'+postUrl[r]+'" title="'+postSum[r]+'">'+postTitle[r]+'</a></td><td class="toc-entry-col2">'+postDate[r]+'</td><td class="toc-entry-col3">'+postLabels[r]+"</td></tr>",s++):-1!=(z=postLabels[r].lastIndexOf(t))&&(e+='<tr><td class="toc-entry-col1"><a href="'+postUrl[r]+'" title="'+postSum[r]+'">'+postTitle[r]+'</a></td><td class="toc-entry-col2">'+postDate[r]+'</td><td class="toc-entry-col3">'+postLabels[r]+"</td></tr>",s++);if(e+="</table>",s==postTitle.length)var i='<span class="toc-note">Displaying all '+postTitle.length+" posts<br/></span>";else{var i='<span class="toc-note">Displaying '+s+" posts labeled '";i+=postFilter+"' of "+postTitle.length+" posts total<br/></span>"}tocdiv.innerHTML=i+e}function toggleTitleSort(){sortPosts(sortBy="titleasc"==sortBy?"titledesc":"titleasc"),displayToc(postFilter)}function toggleDateSort(){sortPosts(sortBy="datenewest"==sortBy?"dateoldest":"datenewest"),displayToc(postFilter)}function showToc(){tocLoaded?(displayToc(postFilter),document.getElementById("toclink")):alert("Just wait... TOC is loading")}function hideToc(){document.getElementById("toc").innerHTML="",document.getElementById("toclink").innerHTML='<a href="#" onclick="scroll(0,0); showToc(); Effect.toggle(\'toc-result\',\'blind\');">\xbb Show Table of Contents</a> <img src="http://chenkaie.blog.googlepages.com/new_1.gif"/>'}
